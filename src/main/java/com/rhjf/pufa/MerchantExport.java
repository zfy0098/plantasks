package com.rhjf.pufa;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.List;
import java.util.Map;
import java.util.UUID;

import org.apache.log4j.Logger;
import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;

import com.rhjf.base.BaseDao;

public class MerchantExport extends BaseDao{

	
	Logger log  =  Logger.getLogger(this.getClass());
	
	
	Integer pageSize = 500;
	
	
	
	public static void main(String[] args) {
		MerchantExport  export = new MerchantExport();
		export.init();
	}
	
	public void init(){
		
		Long startTime = System.currentTimeMillis();
		
		String sqlCount = "SELECT count(t.id) as count  FROM tbl_pay_merchant t,tbl_pay_merchantbankcard tb where t.id = tb.ownerId and t.agent_id=127";
		
		Integer count =  Integer.parseInt(queryForMap(sqlCount, null).get("count").toString());
		
		Integer pageCount = count%pageSize==0?count/pageSize:count/pageSize+1;
		
		log.info("共：" + count + " ， 分：" + pageCount + "页"); 
		
		for (int i = 0; i < pageCount; i++) {
			
			String sql = "SELECT t.signName,t.showName,t.province,t.city,t.address,t.linkPhone,t.legalPerson,t.email,tb.accountNo,tb.accountName,"
					+ "tb.bankBranch,tb.bankProv,tb.bankCity,(select td.value*100 from tbl_online_product_fee td"
					+ " where td.bankId='WX' and t.merchantNo = td.merchantNo) as wxt1fee,(select td.ZFBT1fee*100 from tbl_online_product_fee td where"
					+ " td.bankId='Alipay' and t.merchantNo = td.merchantNo) as alit1fee FROM tbl_pay_merchant t,tbl_pay_merchantbankcard tb "
					+ "where t.id = tb.ownerId and t.agent_id='127' limit   " +  i*pageSize + " ,  500" ;
			
			log.info(sql); 
			
			List<Map<String,Object>> list = queryForList(sql, null);
			try {
				String filename = UUID.randomUUID().toString().toUpperCase();
				createExcel(list, filename);
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		
		Long endTime = System.currentTimeMillis();
		
		log.info((endTime-startTime)/1000 + "秒");
	}
	
	
	
	public void createExcel(List<Map<String,Object>> list , String date) throws IOException{
		if(!new File("/opt/sh/data/pufa").exists()){
			new File("/opt/sh/data/pufa").mkdirs();
		}
		log.info("查询的数据行数 : " + list.size() + "开始创建Excel文件");
		
		   // 创建Excel的工作书册 Workbook,对应到一个excel文档  
	    HSSFWorkbook wb = new HSSFWorkbook();  
	  
	    // 创建Excel的工作sheet,对应到一个excel文档的tab  
	    HSSFSheet sheet = wb.createSheet("商户信息");  
	  
	  
	    // 创建Excel的sheet的一行  
	    HSSFRow row = sheet.createRow(0);  
	    
	    HSSFCell cell = row.createCell(0);  
	    
	    cell.setCellValue("*业务资质代码");
	    cell = row.createCell(1);
	    cell.setCellValue("*机构代码");
	    cell = row.createCell(2);
	    cell.setCellValue("代理代码");
	    cell = row.createCell(3);
	    cell.setCellValue("代理名称");
	    cell = row.createCell(4);
	    cell.setCellValue("集团商户代码");
	    cell = row.createCell(5);
	    cell.setCellValue("集团商户名称");
	    cell = row.createCell(6);
	    cell.setCellValue("*商户名称");
	    cell = row.createCell(7);
	    cell.setCellValue("*商户简称");
	    cell = row.createCell(8);
	    cell.setCellValue("*商户所在省份");
	    cell = row.createCell(9);
	    cell.setCellValue("*商户所在城市");
	    cell = row.createCell(10);
	    cell.setCellValue("*注册地址");
	    cell = row.createCell(11);
	    cell.setCellValue("*客服电话");
	    cell = row.createCell(12);
	    cell.setCellValue("*联系人");
	    cell = row.createCell(13);
	    cell.setCellValue("*联系手机"); 
	    
	    cell = row.createCell(14);
	    cell.setCellValue("*联系邮箱"); 
	    cell = row.createCell(15);
	    cell.setCellValue("*账户属性"); 
	    cell = row.createCell(16);
	    cell.setCellValue("*开户账户"); 
	    cell = row.createCell(17);
	    cell.setCellValue("*开户名称"); 
	    cell = row.createCell(18);
	    cell.setCellValue("*开户银行名称（精确到支行）"); 
	    cell = row.createCell(19);
	    cell.setCellValue("*开户行省份"); 
	    cell = row.createCell(20);
	    cell.setCellValue("*开户行城市"); 
	    cell = row.createCell(21);
	    cell.setCellValue("支付宝经营类目"); 
	    cell = row.createCell(22);
	    cell.setCellValue("*支付宝(%)"); 
	    cell = row.createCell(23);
	    cell.setCellValue("微信经营类目"); 
	    cell = row.createCell(24);
	    cell.setCellValue("*微信(%)"); 
	    cell = row.createCell(25);
	    cell.setCellValue("微信公众号关注"); 
	    cell = row.createCell(26);
	    cell.setCellValue("百度钱包经营类目"); 
	    cell = row.createCell(27);
	    cell.setCellValue("*百度钱包(%)"); 
	    
	    
	    for(int i=0 ; i< list.size() ; i++ ){
	    	
	    	Map<String,Object> map = list.get(i);
	    	
			row = sheet.createRow(i + 1);
			// 设置单元格的样式格式
			cell = row.createCell(0);
			cell.setCellValue("银行模式");

			cell = row.createCell(1);
			cell.setCellValue("91621888");

			cell = row.createCell(2);
			cell.setCellValue("");

			cell = row.createCell(3);
			cell.setCellValue("");

			cell = row.createCell(4);
			cell.setCellValue("");

			cell = row.createCell(5);
			cell.setCellValue("");

			cell = row.createCell(6);
			cell.setCellValue(map.get("signName").toString());

			
			cell = row.createCell(7);
			cell.setCellValue(map.get("showName").toString());

			cell = row.createCell(8);
			cell.setCellValue(map.get("province").toString());

			cell = row.createCell(9);
			cell.setCellValue(map.get("city").toString());

			cell = row.createCell(10);
			cell.setCellValue(map.get("address").toString());

			cell = row.createCell(11);
			cell.setCellValue(map.get("linkPhone").toString());
			
			
			cell = row.createCell(12);
			cell.setCellValue(map.get("legalPerson").toString());
			
			cell = row.createCell(13);
			cell.setCellValue(map.get("linkPhone").toString());
			
			
			
			cell = row.createCell(14);
			cell.setCellValue(map.get("email").toString());


			cell = row.createCell(15);
			cell.setCellValue("0");

			cell = row.createCell(16);
			cell.setCellValue(map.get("accountNo")==null?"":map.get("accountNo").toString());
			
			cell = row.createCell(17);
			cell.setCellValue(map.get("accountName").toString());

			cell = row.createCell(18);
			cell.setCellValue(map.get("bankBranch").toString());

			cell = row.createCell(19);
			cell.setCellValue(map.get("bankProv").toString());

			cell = row.createCell(20);
			cell.setCellValue(map.get("bankCity").toString());

			cell = row.createCell(21);
			cell.setCellValue(alipaymacc[i]);

			cell = row.createCell(22);
			cell.setCellValue(map.get("alit1fee")==null?"":map.get("alit1fee").toString());

			cell = row.createCell(23);
			cell.setCellValue(wxmacc[i]);

			cell = row.createCell(24);
			cell.setCellValue(map.get("wxt1fee").toString());
			cell = row.createCell(25);
			cell.setCellValue("");
			cell = row.createCell(26);
			cell.setCellValue("");
			cell = row.createCell(27);
			cell.setCellValue("");
	 	    
	    }
	    FileOutputStream os = new FileOutputStream("/opt/sh/data/pufa/" + date +".xls");  
	    wb.write(os);  
	    os.close();  
	    wb.close();
	    
	    
	    log.info("生成文件完成"); 
	}
	
	
	public Integer[] wxmacc = {275,293,9,208,205,297,209,294,293,275,158,210,321,158,210,210,210,209,148,275,210,207,204,275,208,319,204,
			9,292,209,297,277,204,293,294,9,209,300,293,204,294,209,292,299,293,295,205,297,297,297,9,300,208,204,294,208,208,209,9,297,300,
			205,294,9,204,209,204,9,9,9,158,9,204,204,209,275,204,158,204,9,204,209,209,209,209,9,209,209,209,209,209,209,9,9,275,275,9,9,209,
			204,209,204,209,204,204,275,204,9,204,204,9,275,204,204,204,204,204,209,209,209,9,209,204,9,204,275,204,209,158,9,9,204,204,204,209,
			204,204,204,9,209,9,204,209,9,204,204,9,204,204,9,204,204,275,204,9,204,204,204,204,158,209,9,209,204,9,9,209,209,275,204,209,9,9,204,
			204,204,209,209,9,204,204,275,209,275,9,9,9,9,9,275,204,204,158,158,9,204,209,204,209,9,204,9,204,158,9,9,9,204,9,204,9,9,204,9,293,204,
			9,209,204,209,204,209,204,275,204,204,204,9,204,204,204,204,204,9,204,204,204,209,209,9,204,275,204,204,9,204,204,275,9,275,209,204,209,
			204,9,204,209,204,204,9,275,9,204,209,204,204,204,293,204,209,204,209,204,209,204,204,209,209,204,9,204,9,158,9,204,204,209,9,209,204,209,
			209,204,275,204,204,204,204,209,209,204,293,209,204,9,9,204,204,9,9,204,209,9,9,204,209,209,209,204,9,204,204,209,204,9,9,275,204,9,204,204,
			9,204,9,204,204,209,204,9,209,209,204,275,204,9,158,204,275,9,9,158,204,209,204,9,158,9,209,204,275,293,204,209,9,9,204,204,209,204,9,204,204,
			9,158,275,204,158,9,9,204,9,204,204,204,204,209,209,9,9,204,9,204,204,204,204,204,275,209,204,204,204,275,204,275,204,204,204,204,9,204,204,204,
			204,275,209,209,209,204,204,275,209,204,204,204,204,204,275,9,209,293,204,9,209,209,9,9,204,204,204,9,9,204,9,209,275,9,275,9,204,209,9,9,204,9,
			204,204,275,204,204,209,9,9,158,275,204,158,204,9,9,204,158,204,209,209,158,9,204,9,9,204,9,9,204,9,209,204,209,9,9,9,204,9,204,204,275,204,9,
			204,275,204};
	
	
	public String[] alipaymacc = {"2015112300111726","2016062900190209","2016062900190097","2016062900190356","2015091000060134","2016062900190085",
			"2015062600009243","2016062900190082","2016062900190204","2015112300111726","2016062900190187","2015091000056956","2016063000191709",
			"2015062600006253","2015062600009243","2016062900190200","2015062600009243","2015062600009243","2015063000019130","2015112300111726",
			"2016062900190107","2015062600009243","2015091000058486","2015112300111726","2016062900190329","2016062900190359","2015091000058486",
			"2016062900190097","2016051000168501","2015091000060134","2015062600009243","2016062900190196","2015091000058486","2016062900190204",
			"2016062900190082","2016062900190097","2015062600009243","2015050700000042","2016062900190200","2015091000058486","2016062900190082",
			"2015062600009243","2015061690000027","2016070700195435","2016062900190209","2016062900190191","2015091000060134","2016062900190103",
			"2016062900190085","2016062900190098","2016062900190097","2015090700041394","2016062900190356","2015091000058486","2016062900190082",
			"2016062900190356","2016062900190356","2015062600009243","2016062900190097","2016062900190098","2015090700041394","2015091000060134",
			"2016062900190082","2016062900190097","2015091000058486","2015062600009243","2015091000058486","2016062900190097","2016062900190097",
			"2016062900190097","2016062900190362","2016062900190097","2015091000058486","2015091000058486","2015062600009243","2015112300111726",
			"2015091000058486","2016062900190362","2015091000058486","2016062900190097","2015091000058486","2015062600009243","2015062600009243",
			"2015062600009243","2015062600009243","2016062900190097","2015062600009243","2015062600009243","2015062600009243","2015062600009243",
			"2015062600009243","2015062600009243","2016062900190097","2016062900190097","2015112300111726","2015112300111726","2016062900190097",
			"2016062900190097","2015062600009243","2015091000058486","2015062600009243","2015091000058486","2015062600009243","2015091000058486",
			"2015091000058486","2015112300111726","2015091000058486","2016062900190097","2015091000058486","2015091000058486","2016062900190097",
			"2015112300111726","2015091000058486","2015091000058486","2015091000058486","2015091000058486","2015091000058486","2015062600009243",
			"2015062600009243","2015062600009243","2016062900190097","2015062600009243","2015091000058486","2016062900190097","2015091000058486",
			"2015112300111726","2015091000058486","2015062600009243","2016062900190362","2016062900190097","2016062900190097","2015091000058486",
			"2015091000058486","2015091000058486","2015062600009243","2015091000058486","2015091000058486","2015091000058486","2016062900190097",
			"2015062600009243","2016062900190097","2015091000058486","2015062600009243","2016062900190097","2015091000058486","2015091000058486",
			"2016062900190097","2015091000058486","2015091000058486","2016062900190097","2015091000058486","2015091000058486","2015112300111726",
			"2015091000058486","2016062900190097","2015091000058486","2015091000058486","2015091000058486","2015091000058486","2016062900190362",
			"2015062600009243","2016062900190097","2015062600009243","2015091000058486","2016062900190097","2016062900190097","2015062600009243",
			"2015062600009243","2015112300111726","2015091000058486","2015062600009243","2016062900190097","2016062900190097","2015091000058486",
			"2015091000058486","2015091000058486","2015062600009243","2015062600009243","2016062900190097","2015091000058486","2015091000058486",
			"2015112300111726","2015062600009243","2015112300111726","2016062900190097","2016062900190097","2016062900190097","2016062900190097",
			"2016062900190097","2015112300111726","2015091000058486","2015091000058486","2016062900190362","2016062900190362","2016062900190097",
			"2015091000058486","2015062600009243","2015091000058486","2015062600009243","2016062900190097","2015091000058486","2016062900190097",
			"2015091000058486","2016062900190362","2016062900190097","2016062900190097","2016062900190097","2015091000058486","2016062900190097",
			"2015091000058486","2016062900190097","2016062900190097","2015091000058486","2016062900190097","2016062900190209","2015091000058486",
			"2016062900190097","2015062600009243","2015091000058486","2015062600009243","2015091000058486","2015062600009243","2015091000058486",
			"2015112300111726","2015091000058486","2015091000058486","2015091000058486","2016062900190097","2015091000058486","2015091000058486",
			"2015091000058486","2015091000058486","2015091000058486","2016062900190097","2015091000058486","2015091000058486","2015091000058486",
			"2015062600009243","2015062600009243","2016062900190097","2015091000058486","2015112300111726","2015091000058486","2015091000058486",
			"2016062900190097","2015091000058486","2015091000058486","2015112300111726","2016062900190097","2015112300111726","2015062600009243",
			"2015091000058486","2015062600009243","2015091000058486","2016062900190097","2015091000058486","2015062600009243","2015091000058486",
			"2015091000058486","2016062900190097","2015112300111726","2016062900190097","2015091000058486","2015062600009243","2015091000058486",
			"2015091000058486","2015091000058486","2016062900190209","2015091000058486","2015062600009243","2015091000058486","2015062600009243",
			"2015091000058486","2015062600009243","2015091000058486","2015091000058486","2015062600009243","2015062600009243","2015091000058486",
			"2016062900190097","2015091000058486","2016062900190097","2016062900190362","2016062900190097","2015091000058486","2015091000058486",
			"2015062600009243","2016062900190097","2015062600009243","2015091000058486","2015062600009243","2015062600009243","2015091000058486",
			"2015112300111726","2015091000058486","2015091000058486","2015091000058486","2015091000058486","2015062600009243","2015062600009243",
			"2015091000058486","2016062900190209","2015062600009243","2015091000058486","2016062900190097","2016062900190097","2015091000058486",
			"2015091000058486","2016062900190097","2016062900190097","2015091000058486","2015062600009243","2016062900190097","2016062900190097",
			"2015091000058486","2015062600009243","2015062600009243","2015062600009243","2015091000058486","2016062900190097","2015091000058486",
			"2015091000058486","2015062600009243","2015091000058486","2016062900190097","2016062900190097","2015112300111726","2015091000058486",
			"2016062900190097","2015091000058486","2015091000058486","2016062900190097","2015091000058486","2016062900190097","2015091000058486",
			"2015091000058486","2015062600009243","2015091000058486","2016062900190097","2015062600009243","2015062600009243","2015091000058486",
			"2015112300111726","2015091000058486","2016062900190097","2016062900190362","2015091000058486","2015112300111726","2016062900190097",
			"2016062900190097","2016062900190362","2015091000058486","2015062600009243","2015091000058486","2016062900190097","2016062900190362",
			"2016062900190097","2015062600009243","2015091000058486","2015112300111726","2016062900190209","2015091000058486","2015062600009243",
			"2016062900190097","2016062900190097","2015091000058486","2015091000058486","2015062600009243","2015091000058486","2016062900190097",
			"2015091000058486","2015091000058486","2016062900190097","2016062900190362","2015112300111726","2015091000058486","2016062900190362",
			"2016062900190097","2016062900190097","2015091000058486","2016062900190097","2015091000058486","2015091000058486","2015091000058486",
			"2015091000058486","2015062600009243","2015062600009243","2016062900190097","2016062900190097","2015091000058486","2016062900190097",
			"2015091000058486","2015091000058486","2015091000058486","2015091000058486","2015091000058486","2015112300111726","2015062600009243",
			"2015091000058486","2015091000058486","2015091000058486","2015112300111726","2015091000058486","2015112300111726","2015091000058486",
			"2015091000058486","2015091000058486","2015091000058486","2016062900190097","2015091000058486","2015091000058486","2015091000058486",
			"2015091000058486","2015112300111726","2015062600009243","2015062600009243","2015062600009243","2015091000058486","2015091000058486",
			"2015112300111726","2015062600009243","2015091000058486","2015091000058486","2015091000058486","2015091000058486","2015091000058486",
			"2015112300111726","2016062900190097","2015062600009243","2016062900190209","2015091000058486","2016062900190097","2015062600009243",
			"2015062600009243","2016062900190097","2016062900190097","2015091000058486","2015091000058486","2015091000058486","2016062900190097",
			"2016062900190097","2015091000058486","2016062900190097","2015062600009243","2015112300111726","2016062900190097","2015112300111726",
			"2016062900190097","2015091000058486","2015062600009243","2016062900190097","2016062900190097","2015091000058486","2016062900190097",
			"2015091000058486","2015091000058486","2015112300111726","2015091000058486","2015091000058486","2015062600009243","2016062900190097",
			"2016062900190097","2016062900190362","2015112300111726","2015091000058486","2016062900190362","2015091000058486","2016062900190097",
			"2016062900190097","2015091000058486","2016062900190362","2015091000058486","2015062600009243","2015062600009243","2016062900190362",
			"2016062900190097","2015091000058486","2016062900190097","2016062900190097","2015091000058486","2016062900190097","2016062900190097",
			"2015091000058486","2016062900190097","2015062600009243","2015091000058486","2015062600009243","2016062900190097","2016062900190097",
			"2016062900190097","2015091000058486","2016062900190097","2015091000058486","2015091000058486","2015112300111726","2015091000058486",
			"2016062900190097","2015091000058486","2015112300111726","2015091000058486"};
}
